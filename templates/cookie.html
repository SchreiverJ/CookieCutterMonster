<!DOCTYPE html>
<html>
    <head>
        Cookie Cutter Monster
    </head>
    <body>
            
                <div class="slidecontainer">
                    <p>Cookie Cutter Size range (2in - 4in):</p>
                    <input type="range" min="50" max="100" value="75" class="slider" id="cookieSize">
                </div>
            <label><strong>Upload File : </strong><input type="file" id="uploadfiles" /></label><br/>
            <script src="lib/FileSaver.js"></script>
            <script src="lib/three.min.js"></script>
            <script src="lib/STLLoader.js"></script>

          <script>
          
         var camera, scene, renderer;
        var geometry, material, mesh;

        init();

        function init() {

            camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.01, 1000 );
            camera.position.z = 500;

            scene = new THREE.Scene();
            material = new THREE.MeshNormalMaterial();
            console.log("Loading File");

            (new THREE.STLLoader()).load( 'lib/tmp.stl', function ( geometry ) {


                mesh = new THREE.Mesh( geometry, material )
                scene.add( mesh );
                //var box = new THREE.Box3().setFromObject( geometry );
                //console.log( box.min, box.max, box.getSize() );
                console.log(mesh.position)

                geometry = new THREE.BoxGeometry( 200, 200, 200 );

                mesh = new THREE.Mesh( geometry, material )
                console.log(mesh.position)
                scene.add( mesh );
                renderer.render( scene, camera );

                var box = new THREE.Box3().setFromObject( geometry );
                console.log( box.min, box.max, box.getSize() );

                animate()
                });

            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );

             }

            function animate() {

                requestAnimationFrame( animate );

                mesh.rotation.x += 0.01;
                mesh.rotation.y += 0.02;

                renderer.render( scene, camera );

            }
                
          </script>
          <script>

                function getCookieSize() {
                return document.getElementById('cookieSize').value;
                }

                function download(filename, content) {

                    var blob = new Blob([content], {
                    type: "text/plain;charset=utf-8"
                    });

                    saveAs(blob, filename);
                }

            (function () {

            var uploadfiles = document.querySelector('#uploadfiles');
            uploadfiles.addEventListener('change', function () {
                var files = this.files;
                for(var i=0; i<files.length; i++){
                    uploadFile(this.files[i]);
                }

            }, false);


            /**
             * Upload a file
             * @param file
             */
            function uploadFile(file){
                var url = "api/getCookieCutter";
                var xhr = new XMLHttpRequest();
                var fd = new FormData();
                xhr.open("POST", url, true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        // Every thing ok, file uploaded
                        download("test.stl", xhr.response)
                        console.log("Hi Im Paul")
                    }
                };
                fd.append('image', file);
                fd.append('size', getCookieSize())
                xhr.send(fd);
            }
            }());
          </script>
    </body>
</html>